<odoo>
    <!-- CGA Report Template
    <template id="template_cga_invoice_document">
        <t t-call="web.basic_layout">
            <style>
                .table_mimpo {
                    margin-bottom: 10px;
                    font-size: 9px;
                }
                .table_mimpo .td_normal {
                    padding-left: 0px;
                    padding-top: 2px;
                    padding-right: 2px;
                    padding-bottom: 2px;
                    font-size: 9px;
                }
                .table_mimpo .td_double_border {
                    border-top: 1px solid black;
                    border-bottom: 1px solid black;
                    padding: 5px;
                    text-align: center;
                    vertical-align: middle;
                    font-size: 9px;
                }
                .table_mimpo .td_border_top_blue {
                    border-top: 1px solid black;
                    color: #3c78d8;
                    padding-left: 0px;
                    padding-top: 2px;
                    padding-right: 2px;
                    padding-bottom: 2px;
                    font-size: 9px;
                }
                .table_mimpo .td_border_top {
                    border-top: 1px solid black;
                    padding-left: 0px;
                    padding-top: 2px;
                    padding-right: 2px;
                    padding-bottom: 2px;
                    font-size: 9px;
                }
                .table_mimpo .th_line_left {
                    border-bottom: 1px solid black;
                    text-align: left;
                    bold: 1px;
                    padding-left: 0px;
                    padding-top: 2px;
                    padding-right: 2px;
                    padding-bottom: 2px;
                    font-size: 9px;
                }
                .table_mimpo .th_line_right {
                    border-bottom: 1px solid black;
                    text-align: right;
                    bold: 1px;
                    padding-left: 0px;
                    padding-top: 2px;
                    padding-right: 2px;
                    padding-bottom: 2px;
                    font-size: 9px;
                }
            </style>
            <div class="header">
                <div class="row col-12">
                    <div class="col-7 mb4" style="border-bottom: 2px solid black; padding-bottom: 3px">
                        <img t-if="doc.company_id.logo" t-att-src="image_data_uri(doc.company_id.logo)" style="max-height: 45px;" alt="Logo"/>
                    </div>
                    <div class="col-1 mb4"/>
                    <div class="col-4 mb4">
                        <p style="font-size: 24px; text-align: left; vertical-align: middle;">
                            <span t-field="doc.name"/> <span t-if="not doc.name or doc.name == '/'" t-field="doc.id"/>
                        </p>
                    </div>
                </div>
                <div class="row col-12">
                    <div class="col-7 mb4" style="font-size: 9px;">
                        <p t-if="doc.company_id.company_details" t-field="doc.company_id.company_details"/>
                        <p t-else="" t-field="doc.company_id.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;], &quot;no_marker&quot;: true}"/>
                    </div>
                    <div class="col-1 mb4"/>
                    <div class="col-4 mb4" style="font-size: 9px;">
                        <p t-field="doc.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;], &quot;no_marker&quot;: true}"/>
                        RFC: <span t-field="doc.partner_id.vat"/>
                    </div>
                </div>
            </div>
            <div class="page">
                <table class="table_mimpo table-borderless" name="sir_information" width="100%">
                    <tbody>
                        <tr>
                            <td width="10%" class="td_normal" style="margin-top: 10px;"><b>REFERENCIA</b></td>
                            <td width="16%" class="td_normal" style="margin-top: 10px;">: <span t-field="doc.sir_id.number"/></td>
                            <td width="14%" class="td_normal" style="margin-top: 10px;"><b>BUQUE</b></td>
                            <td width="16%" class="td_normal" style="margin-top: 10px;">: <span t-field="doc.sir_id.ship"/></td>
                            <td width="22%" class="td_normal" style="margin-top: 10px;"><b>FACTURAS</b></td>
                            <td width="22%" class="td_normal" style="margin-top: 10px;">: <span t-field="doc.sir_id.pedimento_invoice"/></td>
                        </tr>
                        <tr>
                            <td class="td_normal">PEDIMENTO</td>
                            <td class="td_normal">: <span t-field="doc.sir_id.pedimento"/></td>
                            <td class="td_normal">PROVEEDOR</td>
                            <td class="td_normal" rowspan="2">: <span t-field="doc.sir_id.supplier"/></td>
                            <td class="td_normal">MARCAS Y NUMEROS</td>
                            <td class="td_normal">: <span t-field="doc.sir_id.number_mark"/></td>
                        </tr>
                        <tr>
                            <td class="td_normal">FECHA PED</td>
                            <td class="td_normal">: <span t-field="doc.sir_id.pedimento_date"/></td>
                            <td class="td_normal"></td>
                            <td class="td_normal">MERCANCIA</td>
                            <td class="td_normal">: <span t-field="doc.sir_id.ware"/></td>
                        </tr>
                        <tr>
                            <td class="td_normal">REGIMEN</td>
                            <td class="td_normal">: <span t-field="doc.sir_id.operation_type"/></td>
                            <td class="td_normal">PESO EN KGS</td>
                            <td class="td_normal">: <span t-field="doc.sir_id.total_weight"/></td>
                            <td class="td_normal">CANTIDAD DE BULTOS</td>
                            <td class="td_normal">: <span t-field="doc.sir_id.total_package"/></td>
                        </tr>
                        <tr>
                            <td class="td_normal">ADUANA</td>
                            <td class="td_normal">: <span t-field="doc.sir_id.custom_house"/></td>
                            <td class="td_normal"></td>
                            <td class="td_normal" rowspan="2"></td>
                            <td class="td_normal">RECEPCION</td>
                            <td class="td_normal">: <span t-field="doc.sir_id.reception"/></td>
                        </tr>
                        <tr>
                            <td class="td_normal"></td>
                            <td class="td_normal"></td>
                            <td class="td_normal"></td>
                            <td class="td_normal">N* PEDIDO</td>
                            <td class="td_normal">: <span t-field="doc.sir_id.order_number"/></td>
                        </tr>
                    </tbody>
                </table>
                
                <div width="100%" style="border-top: double; border-bottom: double; text-align: center; margin-bottom: 15px; font-size: 9px;">
                    <span>GASTOS EFECTUADOS POR CUENTA DEL CLIENTE</span>
                </div>
                <table name="cga_lines" width="90%" class="table-borderless" style="margin-left: 40px; font-size: 9px;">
                    <t t-foreach="doc.partner_expense_line_ids" t-as="line">
                        <tr>
                            <td style="height: 20px; vertical-align: middle;"><span t-field="line.name"/></td>
                            <td style="text-align: right; height: 20px; vertical-align: middle;"><span t-field="line.total_expense"/></td>
                        </tr>
                    </t>
                    <tr>
                        <td style="text-align: right">SUMA</td>
                        <td style="text-align: right"><span t-field="doc.total_expense"/></td>
                    </tr>
                </table>

                <table class="table_mimpo table-borderless" name="sir_information" width="100%" style="margin-top: 25px">
                    <tbody>
                        <tr>
                            <td colspan="3" class="td_double_border"><b>HONORARIOS</b></td>
                        </tr>
                        <tr>
                            <td width="35%" class="td_normal">VALOR FACTURAS EN MONEDA</td>
                            <td width="25%" class="td_normal" style="text-align: right"><span t-esc="'{:,.2f}'.format(doc.sir_id.total_custom_house)"/></td>
                            <td width="40%" class="td_normal" rowspan="6"></td>
                        </tr>
                        <tr>
                            <td class="td_normal">IMPUESTOS</td>
                            <td class="td_normal" style="text-align: right"><span t-field="doc.sir_id.paid_tax"/></td>
                            <td class="td_normal"></td>
                        </tr>
                        <tr>
                            <td class="td_normal">OTRAS CONTRIBUCIONES</td>
                            <td class="td_normal"></td>
                            <td class="td_normal"></td>
                        </tr>
                        <tr>
                            <t t-set="total_expense" t-value="doc.compute_non_agency_expense()" />
                            <t t-set="total_invoice" t-value="total_expense + (doc.sir_id.total_custom_house or 0) + (doc.sir_id.paid_tax or 0)" />
                            <td class="td_normal">EROGACIONES</td>
                            <td class="td_normal" style="text-align: right"><span t-esc="'{:,.2f}'.format(total_expense)"/></td>
                            <td class="td_normal"></td>
                        </tr>
                        <tr>
                            <td class="td_normal">SUMA</td>
                            <td class="td_normal" style="border-top: 1px solid black; text-align: right"><span t-esc="'{:,.2f}'.format(total_invoice)"/></td>
                            <td class="td_normal"></td>
                        </tr>
                        <tr>
                            <td class="td_normal"></td>
                            <td class="td_normal"></td>
                            <td class="td_normal"></td>
                        </tr>
                        <tr>
                            <td class="td_normal">HONORARIOS</td>
                            <td class="td_normal"></td>
                            <td class="td_normal"></td>
                        </tr>
                    </tbody>
                </table>

                <t t-set="tax_totals" t-value="doc.with_context(mx_edi=True).tax_totals"/> 
                <table name="sir_information" class="table_mimpo table-borderless" width="100%" style="margin-top: 5px;">
                    <tr>
                        <td style="width: 42%">Total Impuestos Trasladados</td>
                        <td class="td_normal" style="width: 45%"></td>
                        <td class="td_normal" style="width: 13%; text-align:right;">
                            <span t-esc="'{:,.2f}'.format(0.0)" />
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 42%"></td>
                        <td class="td_normal" style="width: 45%">SUMA TOTAL</td>
                        <td class="td_normal" style="width: 13%; text-align:right;">
                            <span t-esc="'{:,.2f}'.format(float(doc.total_expense))"/>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 42%"></td>
                        <td class="td_normal" style="width: 45%">ANTICIPO DEL //</td>
                        <td class="td_normal" style="width: 13%; text-align:right;">
                            <t t-esc="'{:,.2f}'.format(doc.trusted_fund_balance)"/>
                        </td>
                    </tr>
                    <tr>
                        <td style="width: 42%"></td>
                        <td class="td_normal" style="width: 45%">SALDO</td>
                        <td class="td_normal" style="width: 13%; text-align:right;">
                            <span t-esc="'{:,.2f}'.format(total_invoice)"/>
                        </td>
                    </tr>
                </table>
                <div style="border-bottom: ridge; font-size: 9px;">
                    <hr style="border-top: 7px double black; margin-top: 0; margin-bottom: 0"/>
                    <strong>SALDO: (<span t-esc="doc._l10n_mx_amount_to_text_from_amount(total_invoice)"/>)</strong>
                </div>
            </div>
        </t>
    </template> -->

    <template id="template_cga_invoice_document">
        <t t-call="web.basic_layout">
            <style>
                .table_mimpo {
                    margin-bottom: 10px;
                    font-size: 9px;
                }
                .table_mimpo .td_normal {
                    padding-left: 0px;
                    padding-top: 2px;
                    padding-right: 2px;
                    padding-bottom: 2px;
                    font-size: 9px;
                }
                .table_mimpo .td_double_border {
                    border-top: 1px solid black;
                    border-bottom: 1px solid black;
                    padding: 5px;
                    text-align: center;
                    vertical-align: middle;
                    font-size: 9px;
                }
                .table_mimpo .td_double_border2 {
                    border-top: 1px solid black;
                    font-size: 1px;padding: 0px;
                }
                .table_mimpo .td_double_border3 {
                    border-bottom: 1px solid black;
                    font-size: 1px;padding: 0px;
                }
                .table_mimpo .td_border_top_blue {
                    border-top: 1px solid black;
                    color: #3c78d8;
                    padding-left: 0px;
                    padding-top: 2px;
                    padding-right: 2px;
                    padding-bottom: 2px;
                    font-size: 9px;
                }
                .table_mimpo .td_border_top {
                    border-top: 1px solid black;
                    padding-left: 0px;
                    padding-top: 2px;
                    padding-right: 2px;
                    padding-bottom: 2px;
                    font-size: 9px;
                }
                .table_mimpo .th_line_left {
                    border-bottom: 1px solid black;
                    text-align: left;
                    bold: 1px;
                    padding-left: 0px;
                    padding-top: 2px;
                    padding-right: 2px;
                    padding-bottom: 2px;
                    font-size: 9px;
                }
                .table_mimpo .th_line_right {
                    border-bottom: 1px solid black;
                    text-align: right;
                    bold: 1px;
                    padding-left: 0px;
                    padding-top: 2px;
                    padding-right: 2px;
                    padding-bottom: 2px;
                    font-size: 9px;
                }
                .table_head_mimpo {
                    margin-bottom: 10px;
                    font-size: 9px;
                }
                .table_head_mimpo tr td{
                    border : 0 hidden black;
                    vertical-align: middle !important;
                }
                .table_head_mimpo .tdnb{
                    border : 0 hidden white;
                }
                .table_head_mimpo .tdb_bottom{
                    border-top: 0 hidden white;
                    border-left: 0 hidden white;
                    border-right: 0 hidden white;
                    border-bottom: 1px solid black;
                }
            </style>
            <div class="header">
                <div class="row" style="font-size: 9px;">
                    <table class="table-sm table_head_mimpo">
                        <tr>
                            <td width="15%" style="border : 0 hidden black;"></td>
                            <td width="3%" style="border : 0 hidden black;"></td>
                            <td width="37%" style="border : 0 hidden black;"></td>
                            <td width="5%" style="border : 0 hidden black;"></td>
                            <td width="8%" style="border : 0 hidden black;" ></td>
                            <td width="24%" style="border : 0 hidden black;border-bottom: 1px solid black"></td>
                            <td width="8%" style="border : 0 hidden black;" ></td>
                        </tr>
                        <tr>
                            <td colspan="2" rowspan="3" style="border: 0 hidden black;border-bottom: 1px solid black;padding-bottom: 3px">
                                <img t-if="doc.company_id.logo" t-att-src="image_data_uri(doc.company_id.logo)"
                                    style="max-height: 45px;" alt="Logo"/>
                            </td>
                            <td colspan="2" rowspan="3" style="vertical-align: top;font-size: 9px;border: 0 hidden black;border-bottom: 1px solid black;padding-bottom: 3px">
                                <strong>
                                    <!-- <span t-if="doc.company_id.company_details" t-field="doc.company_id.company_details"/>
                                    <span t-else="" t-field="doc.company_id.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;], &quot;no_marker&quot;: true}"/>
                                    Suc. Tahel 427 Interior 7<br/>Deleg. Venustiano Carranza<br/>Mexico, CDMX. CP. 15510 -->
                                    MIMPO SERVICIOS ADUANALES SA DE CV<br/>
                                </strong>
                                <strong t-if="doc.move_type != 'out_refund'">
                                    MSA020627T41<br/>
                                    INDEPENDENCIA 778 COL. CENTRO C.P. 91700<br/>
                                    VERACRUZ, VERACRUZ.<br/>
                                    Suc. Tahel 427 Interior 7<br/>
                                    Deleg. Venustiano Carranza<br/>
                                    Mexico, CDMX.CP. 15510
                                </strong>
                                <span t-if="doc.move_type == 'out_refund'">
                                    MSA020627T41<br/>
                                    INDEPENDENCIA 778 COL. CENTRO C.P. 91700<br/>
                                    VERACRUZ, VERACRUZ.<br/>
                                    Suc. Tahel 427 Interior 7<br/>
                                    Deleg. Venustiano Carranza<br/>
                                    Mexico, CDMX.CP. 15510
                                </span>
                            </td>
                            <td rowspan="2" style="border : 0 hidden black;border-right: 1px solid black"></td>
                            <td style="text-align: center; background-color:#D3D3D3;border:1px solid black !important">
                                <!-- CUENTA DE GASTOS No. -->
                                <t t-if="doc.move_type == 'out_refund'">FOLIO</t>
                                <t t-else="">FACTURA</t></td>
                            <td rowspan="2" style="border : 0 hidden black;border-left: 1px solid black"></td>
                        </tr>
                        <tr>
                            <td style="text-align: center;border:1px solid black !important"><span t-field="doc.name"/>
                                <span t-if="not doc.name or doc.name == '/'" t-field="doc.id"/></td>
                        </tr>
                        <tr>
                            <td colspan="3" style="border: 0 hidden black;border-top: 1px solid black;border-bottom: 1px solid black;padding-bottom: 3px">
                                <br/><br/><strong>Expedido en </strong><span t-field="doc.company_id.zip"/> el: <span t-esc="doc.create_date.strftime('%d/%m/%YT%H:%M:%S')" />
                            </td>
                        </tr>
                        <tr t-if="ms_cga">
                            <td style="border: 0 hidden black;border-top: 1px solid black;">
                                <t t-if="doc.move_type == 'out_refund'">E - EGRESO</t>
                                <t t-else="">I - INGRESO</t>
                            </td>
                            <td colspan="2" style="border : 0 hidden black;border-top: 1px solid black;text-transform:uppercase">
                                <span t-esc="doc.partner_id.l10n_mx_edi_fiscal_regime"/> - <span t-field="doc.partner_id.l10n_mx_edi_fiscal_regime"/><br/>
                                USO DE CFDI: <span t-esc="doc.l10n_mx_edi_usage"/> - <span t-field="doc.l10n_mx_edi_usage"/>
                            </td>
                            <td colspan="4" style="border : 0 hidden black;border-top: 1px solid black;">
                                Froma de pago: <span style="text-transform:uppercase" t-field="doc.l10n_mx_edi_payment_method_id"/><br/>
                                <!-- CONDICIONES DE PAGO: <t t-if="doc.invoice_payment_term_id"><span t-field="doc.invoice_payment_term_id"/></t><t t-elif="doc.invoice_date_due"><span t-field="doc.invoice_date_due" /></t> -->
                                <!-- CONDICIONES DE PAGO: <t t-if="doc.invoice_date_due and doc.invoice_date and doc.invoice_date_due &lt;= doc.invoice_date">Contado</t><t t-else="">Crédito</t> -->
                                CONDICIONES DE PAGO: <t t-if="doc.l10n_mx_edi_payment_policy == 'PUE'">Contado</t><t t-else="">Crédito</t>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="page">
                <!-- <div class="row col-12" style="font-size: 9px;">
                    <div class="col-5 mb4" style="font-size: 9px;">
                        <strong>CLIENTE:  </strong>
                        <t t-if="doc.partner_id.commercial_name">
                            <strong t-field="doc.partner_id.commercial_name"/></t>
                        <t t-else=""><strong t-field="doc.partner_id"/></t><br/>
                        <span t-out="doc.partner_id._display_address_mx()"/><br/>
                        REGIMEN FISCAL: <span t-esc="doc.partner_id.l10n_mx_edi_fiscal_regime"/> - <span t-field="doc.partner_id.l10n_mx_edi_fiscal_regime"/><br/>
                        FACTURAS: <span t-field="doc.sir_id.pedimento_invoice"/><br/>
                        MARCAS Y NÚMEROS: <span t-field="doc.sir_id.number_mark"/><br/>
                        MERCANCÍA: <span t-field="doc.sir_id.ware"/><br/>
                        CANTIDAD DE BULTOS: <span t-field="doc.sir_id.total_package"/><br/>
                        RECEPCIÓN: <span t-field="doc.sir_id.reception"/><br/>
                        N° PEDIDO: <span t-field="doc.sir_id.order_number"/>
                    </div>
                    <div class="col-3 mb4"/>
                    <div class="col-4 mb4" style="font-size: 9px;">
                        <strong>REFERENCIA: </strong><span t-field="doc.sir_id"/><br/>
                        PEDIMENTO: <span t-esc="doc._get_complete_pedimento()"/><br/>
                        FECHA PED: <span t-esc="doc._get_pedimento_date()"/><br/>
                        REGIMEN: <t t-if="doc.sir_id.operation_type == 1">Importación</t><t t-elif="doc.sir_id.operation_type == 2">Exportación</t><t t-else=""><span t-field="doc.sir_id.operation_type"/></t><br/>
                        ADUANA: <span t-field="doc.sir_id.custom_house"/><br/><br/><br/>
                        BUQUE: <span t-field="doc.ship"/><br/>
                        PROVEEDOR: <span t-field="doc.sir_id.supplier"/><br/><br/>
                        PESO EN KGS: <span t-field="doc.sir_id.total_weight"/>
                    </div>
                </div> -->
                <t t-set="downpayment" t-value="doc.get_related_downpayment()"/>
                <div class="row">
                    <table class="table_mimpo table-borderless mb4" width="100%" style="font-size: 9px;">
                        <tr>
                            <td rowspan="2" width="40%">
                                <strong>CLIENTE:  </strong>
                                <t t-if="doc.partner_id.commercial_name">
                                    <strong t-field="doc.partner_id.commercial_name"/></t>
                                <t t-else=""><strong t-field="doc.partner_id"/></t><br/>
                                <!-- DOMICILIO: <span t-field="doc.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;], &quot;no_marker&quot;: true}"/>
                                RFC: <span t-field="doc.partner_id.vat"/><br/> -->
                                <span t-out="doc.partner_id._display_address_mx()"/><br/>
                                REGIMEN FISCAL: <span t-esc="doc.partner_id.l10n_mx_edi_fiscal_regime"/> - <span t-field="doc.partner_id.l10n_mx_edi_fiscal_regime"/><br/>
                                FACTURAS: <span t-field="doc.pedimento_invoice"/><br/>
                                MARCAS Y NÚMEROS: <span t-field="doc.number_mark"/><br/>
                                MERCANCÍA: <span t-field="doc.ware"/><br/>
                                CANTIDAD DE BULTOS: <span t-field="doc.total_package"/><br/>
                                RECEPCIÓN: <span t-field="doc.reception"/><br/>
                                N° PEDIDO: <span t-field="doc.order_number"/>
                            </td>
                            <td width="12%" rowspan="2"></td>
                            <td width="15%"></td>
                            <td width="33%">
                                <strong>REFERENCIA: </strong><span t-field="doc.sir_id"/><br/>
                                PEDIMENTO: <span t-esc="doc._get_complete_pedimento()"/><br/>
                                FECHA PED: <span t-esc="doc._get_pedimento_date()"/><br/>
                                REGIMEN: <t t-if="doc.operation_type == 1">Importación</t><t t-elif="doc.operation_type == 2">Exportación</t><t t-else=""><span t-field="doc.operation_type"/></t><br/>
                                ADUANA: <span t-field="doc.custom_house"/><br/><br/><br/>
                                BUQUE: <span t-field="doc.ship"/><br/>
                                PROVEEDOR: <span t-field="doc.supplier"/><br/><br/>
                                PESO EN KGS: <span t-field="doc.total_weight"/>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <t t-if="doc.partner_id.l10n_mx_edi_addenda">
                                    OBSERVACIONES: ANTICIPO DEL <span t-esc="downpayment.get('invoice_date')" />: <span t-esc="'{:,.2f}'.format(downpayment.get('amount', 0.0))" />
                                </t>
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="row">
                <table class="table_mimpo table-borderless" name="gastos_info" width="100%">
                    <tr>
                        <td colspan="3" class="td_double_border2">&amp;nbsp;</td>
                    </tr>
                    <tr>
                        <td colspan="3" class="td_double_border">
                            <b>GASTOS EFECTUADOS POR CUENTA DEL CLIENTE</b></td>
                    </tr>
                    <t t-set="len_iline" t-value="0"/>
                    <!-- <tr t-foreach="doc.invoice_line_ids.filtered(lambda l: not l.trust_fund_account_id and l.cga_line and l.display_type == 'product' and (not l.product_id or not l.to_agency))" t-as="iline"> -->
                    <tr t-foreach="doc._get_gastos_efectuados_line()" t-as="iline">
                        <td name="account_invoice_line_name" class="td_normal">
                            <span t-esc="iline.name" t-options="{'widget': 'text'}"/></td>
                        <td clas="td_normal" style="padding-right:2px;" t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                            <!-- <span class="text-nowrap" t-esc="'{:,.2f}'.format(iline.price_unit)"/> -->
                        </td>
                        <td class="text-end o_price_total td_normal">
                            <span class="text-nowrap" t-esc="abs(iline.price_subtotal)" t-options='{"widget": "float", "precision": 2}' groups="account.group_show_line_subtotals_tax_excluded"/>
                            <span class="text-nowrap" t-esc="abs(iline.price_total)" t-options='{"widget": "float", "precision": 2}' groups="account.group_show_line_subtotals_tax_included"/>
                        </td>
                        <t t-set="len_iline" t-value="len_iline + 1"/>
                    </tr>
                    <t t-if="not ms_cga">
                        <tr t-foreach="range(0, 10-len_iline)" t-as="il">
                            <td colspan="3">&amp;nbsp;</td>
                        </tr>
                    </t>
                    <!-- <t t-foreach="doc.partner_expense_line_ids.filtered(lambda r: not r.to_agency)" t-as="line">
                        <tr>
                            <td style="height: 20px; vertical-align: middle;"><span t-field="line.expense_description"/></td>
                            <td class="td_normal"></td>
                            <td style="text-align: right; height: 20px; vertical-align: middle;"><span t-esc="line.total_expense" t-options='{"widget": "float", "precision": 2}'/></td>
                        </tr>
                    </t> -->
                    <!-- <tr>
                        <td colspan="3" class="td_double_border3">&amp;nbsp;</td>
                    </tr> -->
                    <tr>
                        <td class="td_normal" width="80%"></td>
                        <td class="td_normal" width="10%">SUMA</td>
                        <td class="td_normal" width="10%" name="gastos_suma" style="border-top: 1px solid black;text-align: right;">
                            <span t-esc="doc.total_expense_currency" t-options='{"widget": "float", "precision": 2}'/>
                        </td>
                    </tr>
                    <t t-if="not ms_cga">
                        <tr t-foreach="range(0, 10-len_iline)" t-as="il">
                            <td colspan="3">&amp;nbsp;</td>
                        </tr>
                    </t>
                </table>
                </div>
                <t t-set="cfdi_vals" t-value="doc._l10n_mx_edi_decode_cfdi()"/>
                <t t-set="is_cfdi_signed" t-value="bool(doc._get_l10n_mx_edi_signed_edi_document())"/>
                <table class="table_mimpo table-borderless" name="table_hono" width="100%">
                    <tbody>
                        <tr>
                            <td colspan="5" class="td_double_border2">&amp;nbsp;</td>
                        </tr>
                        <tr>
                            <td colspan="5" class="td_double_border" style="margin-bottom: 15px;"><b>HONORARIOS</b></td>
                        </tr>
                        <tr>
                            <!-- <td width="20%" class="td_normal" rowspan="6" style="padding-top: 5px; padding-left: 10px;">
                                <t t-if="is_cfdi_signed">
                                    <div t-if="cfdi_vals.get('sello')" class="barcode col-3">
                                        <img alt="Barcode" t-att-src="'/report/barcode/?barcode_type=QR&amp;value=%s&amp;width=100&amp;height=100' % quote_plus(
                                            'https://verificacfdi.facturaelectronica.sat.gob.mx/default.aspx?' + keep_query(
                                                re=doc.l10n_mx_edi_cfdi_supplier_rfc, rr=doc.l10n_mx_edi_cfdi_customer_rfc,
                                                tt='%.*f' % (doc.currency_id.decimal_places, doc.l10n_mx_edi_cfdi_amount), id=doc.l10n_mx_edi_cfdi_uuid)
                                                + '&amp;fe=%s' % quote_plus(
                                                    cfdi_vals['sello'][-8:], 'utf-8', 'strict', '=/').replace('%2B', '+'))"/>
                                    </div>
                                </t>
                            </td> -->
                            <td width="5%" class="td_normal" rowspan="6"></td>
                            <td width="30%" class="td_normal">VALOR FACTURAS EN MONEDA</td>
                            <td width="30%" class="td_normal" style="text-align:right;"><span t-field="doc.sir_id.total_custom_house"/></td>
                            <td width="23%" class="td_normal" rowspan="6"></td>
                            <td width="12%" class="td_normal" rowspan="6"></td>
                        </tr>
                        <tr>
                            <td class="td_normal">IMPUESTOS</td>
                            <td class="td_normal" style="text-align:right;"><span t-field="doc.sir_id.paid_tax"/></td>
                        </tr>
                        <tr>
                            <td class="td_normal">OTRAS CONTRIBUCIONES</td>
                            <td class="td_normal" name="td_otras" style="text-align:right;">0.00</td>
                        </tr>
                        <tr>
                            <td class="td_normal">EROGACIONES</td>
                            <td class="td_normal" name="td_eroga" style="text-align:right;"><span t-esc="doc.total_expense_currency" t-options='{"widget": "float", "precision": 2}'/></td>
                        </tr>
                        <tr>
                            <td class="td_normal">SUMA</td>
                            <td class="td_normal" name="table_suma_hono" style="border-top: 1px solid black;text-align:right;">
                                <t t-set="suma_hono" t-value="doc.sir_id.total_custom_house + doc.sir_id.paid_tax + doc.total_expense_currency"/>
                                <span t-esc="'{:,.2f}'.format(suma_hono)"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="td_normal"></td>
                            <td class="td_normal"></td>
                        </tr>
                        <tr t-if="not ms_cga">
                            <td class="td_normal"></td>
                            <td class="td_normal" colspan="2">HONORARIOS</td>
                            <td class="td_normal" colspan="2" style="text-align:right;">0.00</td>
                        </tr>
                        <tr t-if="ms_cga">
                            <td class="td_normal" colspan="5"></td>
                        </tr>
                        <tr>
                            <td class="td_normal" colspan="5"></td>
                        </tr>
                        <tr>
                            <td class="td_normal" colspan="5"></td>
                        </tr>
                        <t t-if="not ms_cga">
                            <t t-set="total_tax16" t-value="doc._get_total_tax16_base()"/>
                            <t t-set="tax_totals" t-value="doc.tax_totals"/> 
                            <tr>
                                <td class="td_normal"></td>
                                <td class="td_normal" colspan="3">TOTAL IMPUESTOS TRASLADADOS 16% BASE</td>
                                <td class="td_normal" style="text-align:right;">
                                    <strong t-esc="abs(total_tax16)" t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>
                                </td>
                            </tr>
                            <tr>
                                <td class="td_normal" colspan="3"></td>
                                <td class="td_normal"><b>SUMA TOTAL</b></td>
                                <td class="td_normal" style="text-align:right;">
                                    <strong t-field="doc.total_expense_currency"/></td>
                            </tr>
                            <tr>
                                <td class="td_normal" colspan="3"></td>
                                <td class="td_normal">ANTICIPO DEL //</td>
                                <td class="td_normal" style="text-align:right;">
                                    <span t-field="doc.trusted_fund_balance"/></td>
                            </tr>
                            <tr>
                                <td colspan="3"></td>
                                <td class="td_border_top"><strong>SALDO</strong></td>
                                <td class="td_border_top" style="text-align: right;"><strong t-esc="tax_totals['formatted_amount_total']"/></td>
                            </tr>
                        </t>
                        <!-- <tr>
                            <td colspan="5" class="td_double_border">
                                <b>SALDO: <span t-esc="doc.currency_id.with_context(lang='es_MX').amount_to_text(abs(saldo_total))"/></b></td>
                        </tr> -->
                    </tbody>
                </table>
                <t t-set="lines" t-value="doc.with_context(ms_cga=ms_cga).get_ms_invoice_lines()"/>
                <!-- <t t-if="lines"> -->
                <table t-if="ms_cga" name="prod_info" class="table_mimpo table-borderless" width="100%" style="margin-top: 5px;font-family:Arial;font-size: 8px;">
                    <tr t-if="ms_cga">
                        <th width="7%" class="th_line_left"><b>N. IDEN</b></th>
                        <th width="28%" class="th_line_left"><b>CONCEPTO</b></th>
                        <th width="10%" class="th_line_left"><b>PROD</b></th>
                        <th width="6%" class="th_line_left"><b>C. UNI</b></th>
                        <th width="14%" class="th_line_left"><b>U. MEDIDA</b></th>
                        <th width="10%" class="th_line_right"><b>P. UNITARIO</b></th>
                        <th width="14%" class="th_line_left" style="padding-left:5px;"><b>IMPUESTO</b></th>
                        <th width="11%" class="th_line_right"><b>IMPORTE</b></th>
                    </tr>
                    <tbody class="invoice_tbody">
                        <t t-set="current_subtotal" t-value="0"/>
                        <t t-foreach="lines" t-as="line">
                            <t t-set="current_subtotal" t-value="current_subtotal + line.get('price_subtotal', 0.0)" groups="account.group_show_line_subtotals_tax_excluded"/>
                            <t t-set="current_subtotal" t-value="current_subtotal + line.get('price_total', 0.0)" groups="account.group_show_line_subtotals_tax_included"/>

                            <tr t-att-class="'bg-200 fw-bold o_line_section' if line.get('display_type') == 'line_section' else 'fst-italic o_line_note' if line.get('display_type') == 'line_note' else ''"
                                style="font-size: 7px;">
                                <t t-if="line.get('display_type') == 'product'" name="account_invoice_line_accountable">
                                    <td class="td_normal"><span t-esc="line.get('product_code')"/></td>
                                    <td name="account_invoice_line_name" class="td_normal" style="font-size: 7px;"><span t-esc="line.get('product_name')"/></td>
                                    <td class="td_normal"><span t-esc="line.get('product_unspsc_code')"/></td>
                                    <td class="td_normal"><span t-esc="line.get('uom_unspsc_code')"/></td>
                                    <td class="td_normal" style="font-size: 7px;"><span t-esc="line.get('uom_unspsc_name')"/></td>
                                    <td clas="td_normal" style="padding-right:2px;" t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span class="text-nowrap" t-esc="line.get('price_unit')"/>
                                    </td>
                                    <td class="td_normal" style="padding-left:5px;" t-attf-class="text-start {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span t-if="line.get('list_tax')" t-esc="', '.join(line.get('list_tax'))" id="line_tax_ids"/>
                                    </td>
                                    <td class="text-end o_price_total td_normal">
                                        <span class="text-nowrap" t-esc="doc._get_format_price(amount=line.get('price_subtotal'))" groups="account.group_show_line_subtotals_tax_excluded"/>
                                        <span class="text-nowrap" t-esc="doc._get_format_price(amount=line.get('price_total'))" groups="account.group_show_line_subtotals_tax_included"/>
                                        <!-- <span class="text-nowrap" t-esc="line.get('price_subtotal')" t-options='{"widget": "monetary", "digits": 2, "display_currency": doc.currency_id}' groups="account.group_show_line_subtotals_tax_excluded"/>
                                        <span class="text-nowrap" t-esc="line.get('price_total')" t-options='{"widget": "monetary", "digits": 2, "display_currency": doc.currency_id}' groups="account.group_show_line_subtotals_tax_included"/> -->
                                    </td>
                                </t>
                                <t t-if="line.get('display_type') == 'line_section'">
                                    <td colspan="99" class="td_normal">
                                        <span t-esc="line.get('name')" t-options="{'widget': 'text'}"/>
                                    </td>
                                </t>
                                <t t-if="line.get('display_type') == 'line_note'">
                                    <td colspan="99" class="td_normal">
                                        <span t-esc="line.get('name')" t-options="{'widget': 'text'}"/>
                                    </td>
                                </t>
                            </tr>
                        </t>
                        <t t-set="tax_totals" t-value="doc._get_tax_totals_mimpo()"/> 
                        <!-- <tr>
                            <td colspan="4"/>
                            <td class="td_border_top_blue" colspan="3"><b>Importe sin impuestos</b></td>
                            <td class="td_border_top" style="text-align: right;"><span t-esc="tax_totals['formatted_amount_total']"/></td>
                        </tr> -->
                        <tr>
                            <td colspan="4"></td>
                            <td class="td_normal" colspan="3"></td>
                            <td></td>
                        </tr>
                        <!-- <t t-foreach="tax_totals['subtotals']" t-as="subtotal">
                            <t t-set="subtotal_to_show" t-value="subtotal['name']"/>
                            <tr t-foreach="tax_totals['groups_by_subtotal'][subtotal_to_show]" t-as="amount_by_group">
                                <td colspan="4"></td>
                                <td class="td_normal" colspan="3">
                                    <span t-esc="amount_by_group['tax_group_name']"/>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BASE <span t-esc="'{:,.2f}'.format(amount_by_group['tax_group_base_amount'])"/>
                                </td>
                                <td class="td_normal" style="text-align:right;">
                                    <span>
                                        <t t-esc="amount_by_group['formatted_tax_group_amount']"/>
                                    </span>
                                </td>
                            </tr>
                        </t> -->
                        <t t-set="total_tax16" t-value="doc._get_total_tax16_base(tax_totals=tax_totals)"/>
                        <tr>
                            <td class="td_normal" style="text-align:center;" colspan="7">
                                TOTAL IMPUESTOS TRASLADADOS 16% BASE <span t-esc="abs(current_subtotal)" t-options='{"widget": "float", "decimal_precision": "Product Price"}'/></td>
                            <td class="td_normal" style="text-align:right;">
                                <strong t-esc="doc._get_format_price(amount=abs(total_tax16))"/>
                                <!-- <strong t-esc="abs(total_tax16)" t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/> -->
                            </td>
                        </tr>
                        <tr>
                            <td class="td_normal" colspan="6"></td>
                            <td class="td_normal"><b>SUMA TOTAL</b></td>
                            <td class="td_normal" style="text-align:right;">
                                <t t-set="suma_total" t-value="doc.total_expense_currency + current_subtotal + abs(total_tax16)"/>
                                <strong t-esc="doc._get_format_price(amount=suma_total)"/>
                                <!-- <span t-esc="suma_total" t-options='{"widget": "monetary", "digits": 2, "display_currency": doc.currency_id}'/> -->
                            </td>
                        </tr>
                        <tr>
                            <td class="td_normal" colspan="6"></td>
                            <td class="td_normal">ANTICIPO DEL //</td>
                            <td class="td_normal" style="text-align:right;">
                                <span t-esc="doc._get_format_price(amount=doc.trusted_fund_balance)"/>
                                <!-- <span t-esc="doc.trusted_fund_balance" t-options='{"widget": "monetary", "digits": 2, "display_currency": doc.currency_id}'/> -->
                            </td>
                        </tr>
                        <!-- <tr>
                            <td class="td_normal" colspan="3"></td>
                            <td class="td_normal"><b>SALDO</b></td>
                            <td class="td_normal" style="text-align:right;border-top:1px solid black">
                                <t t-set="saldo_total" t-value="abs(doc.trusted_fund_balance - doc.total_expense_currency) + total_tax16"/>
                                <strong t-esc="abs(saldo_total)" t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>
                            </td>
                        </tr> -->
                        <!-- <tr>
                            <td colspan="4"></td>
                            <td class="td_normal" colspan="3">ANTICIPO</td>
                            <td style="text-align:right;"><span t-esc="'{:,.2f}'.format(downpayment.get('amount', 0.0))"/></td>
                        </tr> -->
                        <tr>
                            <td colspan="6"></td>
                            <td class="td_border_top"><strong>SALDO</strong></td>
                            <td class="td_border_top" style="text-align: right;">
                                <t t-set="saldo_tot" t-value="suma_total - doc.trusted_fund_balance"/>
                                <strong t-esc="doc._get_format_price(amount=abs(saldo_tot))"/>
                                <!-- <strong t-esc="saldo_tot" t-options='{"widget": "monetary", "digits": 2, "display_currency": doc.currency_id}'/> -->
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="row" t-if="ms_cga">
                    <div class="col-2"/>
                    <div class="col-10" style="font-size: 9px;">
                        <div style="border-bottom: 1px solid black; margin-bottom: 3px;"><strong>SALDO: (<span t-esc="doc._l10n_mx_edi_cfdi_amount_to_text()"/>)</strong></div>
                        <div style="border-top: 1px solid black; margin-top: 2px;">Ingresos + IVA: (<span t-esc="doc._l10n_mx_edi_mimpo_amount_to_text(amount=abs(current_subtotal + abs(total_tax16)))"/>)</div>
                    </div>
                </div>
                <div class="row" t-if="not ms_cga" style="border-top: 1px solid black;font-size: 9px;">
                    <div style="border-top: 1px solid black;border-bottom: 1px solid black; margin-bottom: 3px;">
                        <strong>SALDO: (<span t-esc="doc._l10n_mx_edi_cfdi_amount_to_text()"/>)</strong></div>
                </div>

                <table t-if="doc.move_type == 'out_refund' or doc.down_payment_invoice_id or doc.reversed_dp_inv_id" class="table_mimpo table-borderless" name="cfdi_relation" width="100%" style="margin-top: 5px; font-size: 9px !important;">
                    <t t-set="cfdi_origin" t-value="doc.get_cfdi_origin()" />
                    <tr style="border-top: 1px solid black; font-size: 9px !important; margin-bottom: 5px;">
                        <td colspan="2" class="text-center"><strong>CFDI RELACIONADO</strong></td>
                    </tr>
                    <tr style="border-top: 1px solid black;">
                        <td width="50%"><strong>Tipo de Relación:</strong> <span t-if="cfdi_origin" t-esc="cfdi_origin[0]" /></td>
                        <td width="50%"><strong>UUID Relacionado:</strong> <span t-if="cfdi_origin" t-esc="cfdi_origin[1]" /></td>
                    </tr>
                </table>

                <t t-if="is_cfdi_signed and ms_cga">
                    <div class="complement-details col-12" style="page-break-inside: avoid; margin-top: 5px; border: 1px solid black; font-size: 9px; padding-left: 5px; padding-right: 5px;">
                        Fecha y Hora de Certificación: <span t-esc="cfdi_vals.get('emission_date_str')"/><br/>
                        <strong>Cadena original del complemento de certificación digital del SAT</strong><br/>
                        <div class="digital-stamp-content">
                            <span class="nowrap" t-esc="cfdi_vals.get('cadena')"/>
                        </div>
                        <strong>Sello del SAT</strong><br/>
                        <div class="digital-stamp-content">
                            <span t-esc="cfdi_vals.get('sello_sat')"/>
                        </div>
                        <strong>Sello digital del CFDI</strong><br/>
                        <div class="digital-stamp-content">
                            <span t-esc="cfdi_vals.get('sello')"/>
                        </div>
                    </div>
                </t>
                <div class="row" style="font-size: 9px; margin-top: 10px; page-break-inside: avoid;">
                    <div class="col-3">CLAVE CONFIRMACION:</div>
                    <div class="col-9" style="text-align: right" t-if="ms_cga">
                        <t t-if="doc.l10n_mx_edi_payment_policy">
                            METODO DE PAGO: <span t-field="doc.l10n_mx_edi_payment_policy" /> - 
                            <span t-if="doc.l10n_mx_edi_payment_policy == 'PPD'">PAGO EN PARCIALIDADES O DIFERIDO</span>
                            <span t-if="doc.l10n_mx_edi_payment_policy == 'PUE'">PAGO EN UNA SOLA EXHIBICION</span>
                        </t>
                    </div>
                </div>
                <!-- </t> -->
            </div>
        </t>
    </template>

    <template id="template_cga_report">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="lang" t-value="doc.partner_id.lang"/>
                <t t-call="mpo_cga_report.template_cga_invoice_document" t-lang="lang"/>
            </t>
        </t>
    </template>

    <record id="paperformat_cga_report" model="report.paperformat">
        <field name="name">CGA Invoice Paperformat</field>
        <field name="default" eval="False"/>
        <field name="disable_shrinking" eval="True"/>
        <field name="format">A4</field>
        <field name="page_height">0</field>
        <field name="page_width">0</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">45</field>
        <field name="margin_bottom">27</field>
        <field name="margin_left">7</field>
        <field name="margin_right">7</field>
        <field name="header_spacing">40</field>
        <field name="dpi">90</field>
    </record>

    <record id="report_cga_invoice" model="ir.actions.report">
        <field name="name">Factura CGA</field>
        <field name="model">account.move</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">mpo_cga_report.template_cga_report</field>
        <field name="report_file">mpo_cga_report.template_cga_report</field>
        <field name="print_report_name">(object._get_report_base_filename())</field>
        <!-- <field name="binding_model_id" ref="account.model_account_move"/> -->
        <field name="paperformat_id" ref="mpo_cga_report.paperformat_cga_report"/>
        <field name="binding_type">report</field>
    </record>
</odoo>